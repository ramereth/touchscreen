<!--
    osl_bandwidth.html
    by Rob McGuire-Dale, 3/7/2009
    last modified by Rob McGuire-Dale, 9/23/2009

    This screen displays osl bandwidth graphs
-->

<script type="text/javascript">
function {{screen.hash}}()
{
    //////////
    // Data //
    //////////
    
    // a graph set object consisting of two graphs and a title
    function graphSet( title, graph1, graph2 )
    {
        this.title = title;
        this.graph1 = graph1;
        this.graph2 = graph2;
    }

    // a set of graph sets
    var graphSets = new Array(
        new graphSet(
            '{{settings.screens_osl_bandwidth.title_0}}',
            '{{settings.screens_osl_bandwidth.imgAddr_0a}}',
            '{{settings.screens_osl_bandwidth.imgAddr_0b}}'
        ),
        new graphSet(
            '{{settings.screens_osl_bandwidth.title_1}}',
            '{{settings.screens_osl_bandwidth.imgAddr_1a}}',
            '{{settings.screens_osl_bandwidth.imgAddr_1b}}'
        ),
        new graphSet(
            '{{settings.screens_osl_bandwidth.title_2}}',
            '{{settings.screens_osl_bandwidth.imgAddr_2a}}',
            '{{settings.screens_osl_bandwidth.imgAddr_2b}}'
        ),
        new graphSet(
            '{{settings.screens_osl_bandwidth.title_3}}',
            '{{settings.screens_osl_bandwidth.imgAddr_3a}}',
            '{{settings.screens_osl_bandwidth.imgAddr_3b}}'
        ),
        new graphSet(
            '{{settings.screens_osl_bandwidth.title_4}}',
            '{{settings.screens_osl_bandwidth.imgAddr_4a}}',
            '{{settings.screens_osl_bandwidth.imgAddr_4b}}'
        ),
        new graphSet(
            '{{settings.screens_osl_bandwidth.title_5}}',
            '{{settings.screens_osl_bandwidth.imgAddr_5a}}',
            '{{settings.screens_osl_bandwidth.imgAddr_5b}}'
        )
    );
    
    // ======================
    //  SCREEN PLUGIN EVENTS
    // ======================
    //      Functions that are run at particular events in the screen plugin's
    //      life cycle.

    this.init = function()
    {
        safelog('osl_bandwidth: initializing...');

        //write the html for the tiles
        write_tile_html();

        // position the tiles
        positionTiles();
    };

    this.start = function()
    {
        safelog('osl_bandwidth: starting...');

        // position the thumbnail tiles
        positionTiles();

        // randomize the main tile
        randomizeMainTile();

        // make images refresh themselves at the specified interval
        $(".osl_bandwidth_img").refreshImage({
            interval:
                {{settings.screens_osl_bandwidth.imgRefreshInterval}},
            start:true
        });
    };

    this.stop = function()
    {
        safelog('osl_bandwidth: stopping...');
    };

    this.onWinResize = function()
    {
        positionTiles();
    };

    ///////////////////
    // MENU COMMANDS //
    ///////////////////

    // a menu command to show the specified graph set (by name, first
    // encountered)
    this.show = function( name )
    {
        var index = null;
        
        // find the index of the graph set by name
        for( i in graphSets ){

            if( graphSets[i].title == name ){
                index = i;
                break;
            }
        }

        // if the graph set is found, display it to the main tile
        if( index != null ) displayToMainTile( index );
        else safelog( "osl_bandwidth: show: graph set '"+name+"' not found." );
    }

    // ==============
    //  INITIALIZERS
    // ==============
    //      Functions that initialize elements of the the screen plugin.

    function write_tile_html()
    {
        // write the thumbnails
        for( var i = 0; i < graphSets.length; i++ ){
            $("#osl_bandwidth_wrapper").append(
                '<div id="osl_bandwidth_thumb_'+i+'" class="display_img_thumb display_tile ">'+

                    '<div id="osl_bandwidth_title_'+i+'" class="display_img_thumb_caption">'+
                        graphSets[i].title+
                    '</div>'+

                    '<img id="osl_bandwidth_img_'+i+'a" class="osl_bandwidth_img"'+
                        'src="'+graphSets[i].graph1+'"'+
                        'height="{{settings.screens_osl_bandwidth.thumbnail_img_height}}"'+
                        'width="{{settings.screens_osl_bandwidth.thumbnail_img_width}}">'+

                    '<img id="osl_bandwidth_img_'+i+'b" class="osl_bandwidth_img"'+
                        'src="'+graphSets[i].graph2+'"'+
                        'height="{{settings.screens_osl_bandwidth.thumbnail_img_height}}"'+
                        'width="{{settings.screens_osl_bandwidth.thumbnail_img_width}}">'+
                '</div>'
            );
        }

        // randomize the main tile
        randomizeMainTile();
    }

    // click event handling (NOTE: this is meant as a secondary interface to the
    // menu interface
    function initTileClickEvents()
    {
        $("#osl_bandwidth_thumb_0").click(function(){displayToMainTile(0)});
        $("#osl_bandwidth_thumb_1").click(function(){displayToMainTile(1)});
        $("#osl_bandwidth_thumb_2").click(function(){displayToMainTile(2)});
        $("#osl_bandwidth_thumb_3").click(function(){displayToMainTile(3)});
        $("#osl_bandwidth_thumb_4").click(function(){displayToMainTile(4)});
        $("#osl_bandwidth_thumb_5").click(function(){displayToMainTile(5)});
    }

    // ==============
    //  FACILITATORS
    // ==============
    //      Functions responsible for manipulating the tiles

    function positionTiles()
    {
        // calculate the padding between the tiles to evently distribute them
        // across the screen
        var horizPadding = (screenWidth() -
            $("#osl_bandwidth_thumb_0").outerWidth(true) *
            graphSets.length/2)/
            ((graphSets.length/2) - 1);

        // position the thumbs
        for( var i = 0; i < graphSets.length/2; i++ ){

            // top row
            $("#osl_bandwidth_thumb_" + i).css('left',
                $("#osl_bandwidth_thumb_0").outerWidth(true) * i +
                horizPadding * i);

            // bottom row
            $("#osl_bandwidth_thumb_" + (i + graphSets.length/2)).css('bottom', 0 );
            $("#osl_bandwidth_thumb_" + (i + graphSets.length/2)).css('left',
                $("#osl_bandwidth_thumb_0").outerWidth(true) * i +
                horizPadding * i );
        }

        // place the tile in the middle of the screen
        $("#osl_bandwidth_main").css('top', screenHeight()/2 -
            $("#osl_bandwidth_main").outerHeight(true)/2);
        $("#osl_bandwidth_main").css('left', screenWidth()/2 -
            $("#osl_bandwidth_main").outerWidth(true)/2);
    }

    // display a random graph pair to the main tile
    function randomizeMainTile(){

        // fill the main tile with a random graph and title set
        var randIndex=Math.floor(
            Math.random()*graphSets.length
        );

        displayToMainTile( randIndex );
    }

    // Display a graph set to the main tile
    function displayToMainTile( graphSetIndex )
    {
        var speed = "fast"; // fade in/fade out speed

        // fade out the main tile
        $("#osl_bandwidth_main").fadeOut( speed, function(){

            // fill the main tile with the title and the picture of the
            // specified webcam shot
            $("#osl_bandwidth_title_main").html( graphSets[graphSetIndex].title+
                " Bandwidth Usage" );
            $("#osl_bandwidth_img_main_a").attr( 'src',
                graphSets[graphSetIndex].graph1
            );
            $("#osl_bandwidth_img_main_b").attr( 'src',
                graphSets[graphSetIndex].graph2
            );
            $("#osl_bandwidth_img_main").height(
                {{settings.screens_osl_bandwidth.mainTile_height}}
            );

            // set max height and width
            $("#osl_bandwidth_img_main").attr( 'max-height',
                '{{settings.screens_osl_bandwidth.mainTile_height}}' );
            $("#osl_bandwidth_img_main").attr( 'max-width',
                '{{settings.screens_osl_bandwidth.mainTile_width}}' );
        });

        // fade the main tile back in
        $("#osl_bandwidth_main").fadeIn( speed );
    }

} {{screen.hash}} = new {{screen.hash}}();
</script>

<div id="osl_bandwidth_wrapper">
    <div id='osl_bandwidth_main' class='display_img display_tile'>

        <div id='osl_bandwidth_title_main' class='display_img_caption'>
            {{settings.screens_osl_bandwidth.title_0}}
        </div>

        <table>
            <tr>
                <td>
                    <img id='osl_bandwidth_img_main_a' class='osl_bandwidth_img'
                    src='{{settings.screens_osl_bandwidth.imgAddr_0a}}'
                    height={{settings.screens_osl_bandwidth.mainTile_height}}
                    width={{settings.screens_osl_bandwidth.mainTile_width}}>
                </td>

                <td>
                    <img id='osl_bandwidth_img_main_b' class='osl_bandwidth_img'
                    src='{{settings.screens_osl_bandwidth.imgAddr_0b}}'
                    height={{settings.screens_osl_bandwidth.mainTile_height}}
                    width={{settings.screens_osl_bandwidth.mainTile_width}}>
                </td>
            </tr>
        </table>
    </div>
</div>
